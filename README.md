# サーバーレス ファイルアップローダー

## 概要 (Overview)
AWSのサーバーレス技術とTerraform (IaC) を活用して構築した、Webベースのファイルアップローダーです。

このプロジェクトは、「S3はAmazon Photosより安価か？」という技術的な探究心からスタートしました。調査を進める中で、単にファイルを保存するだけでなく、モダンなクラウドアプリケーションに求められる**セキュリティとスケーラビリティ**をいかにして実現するか、という課題に挑戦しました。

その解決策として、クライアントから安全にファイルをアップロードさせるために**S3署名付きURL**を動的に発行するAPIを実装。これにより、私のバックエンドサーバーを経由せず、ブラウザからS3へ直接ファイルをアップロードできます。さらに、アップロード完了後は**S3イベント通知**をトリガーにLambdaを非同期で実行し、ファイル情報をDynamoDBへ自動記録する**イベント駆動型**の仕組みを取り入れています。

この開発を通じて、Terraformによるインフラのコード化、サーバーレスアーキテクチャの設計・実装スキルを実践的に深めると共に、自作システムとフルマネージドサービスのコスト・利便性におけるトレードオフを考察する良い機会となりました。
## アーキテクチャ図 (Architecture Diagram)

![サーバーレスファイルアップローダー構成図](images/file_uploader_architecture.png)
<<<<<<< HEAD
=======
## シーケンス (Sequence)

>>>>>>> 8f65fd7c0a50cb1b5e14746702d2ee534949525a
## 処理フロー (Processing Flow)

このアプリケーションの主要な機能は、以下の流れで実現されています。

### ファイルアップロード処理フロー

- **① サイト表示:** ユーザーがブラウザでS3の静的ウェブサイトにアクセスします。
- **② URLリクエスト:** JavaScriptがAPI Gateway (`POST /generate-presigned-url`) に署名付きURLを要求します。
- **③ Lambda実行 (URL生成):** API Gatewayが「署名付きURL生成Lambda」をトリガーします。
- **④ URL応答:** Lambdaが生成した署名付きURLをブラウザに返します。
- **⑤ ファイル送信:** JavaScriptが署名付きURLを使い、ファイル本体をS3バケットに直接アップロード (PUT) します。
- **⑥ イベント通知:** S3へのファイル作成をトリガーに、「メタデータ保存Lambda」が起動します。
- **⑦ メタデータ保存:** Lambdaがファイル情報をDynamoDBに書き込みます。

### ファイル一覧表示処理フロー

- **⑧ 一覧リクエスト:** JavaScriptがAPI Gateway (`GET /files`) にファイル一覧を要求します。
- **⑨ Lambda実行 (一覧取得):** API Gatewayが「ファイル一覧取得Lambda」をトリガーします。
- **⑩ DBスキャン:** LambdaがDynamoDBのテーブルをスキャンして全ファイル情報を取得します。
- **⑪ 一覧応答:** Lambdaが取得したファイルリストをブラウザに返します。

## 使用技術一覧 (Tech Stack)

### IaC (Infrastructure as Code)
- Terraform

### AWS (Backend)
- **API Gateway:** HTTP API
- **Lambda:** Python 3.11 Runtime
- **S3:** ファイルストレージ, (静的ウェブサイトホスティング)
- **DynamoDB:** メタデータストレージ
- **IAM:** 各種権限管理 (ロール, ポリシー)
- **CloudWatch:** ログ監視

### Programming Language
- Python 3
  - Boto3 (AWS SDK)

### Frontend
- HTML
- CSS (Pico.css フレームワーク利用)
- JavaScript (Fetch API)

## 機能一覧 (Features)

- **ファイルアップロード機能:**
  - Webブラウザからファイルを選択し、アップロードできます。
  - バックエンドでS3署名付きURLを動的に生成し、安全かつ効率的にS3へ直接ファイルをアップロードする仕組みを実装しています。
- **メタデータ自動保存機能:**
  - S3へのファイルアップロードをトリガーとして、Lambda関数が自動実行されます。
  - ファイル名、S3の保存先パス、ファイルサイズ、更新日時などのメタデータがDynamoDBに自動的に記録されます。
- **ファイル一覧表示機能:**
  - アップロードされたファイルの一覧をAPI経由でDynamoDBから取得し、Webページ上に動的に表示します。

## 使い方・動かし方 (Usage / How to Deploy)

<<<<<<< HEAD
このプロジェクトのインフラをAWS上にデプロイするための手順です。

### 必要なもの (Prerequisites)

* AWSアカウント & IAMユーザー（適切な権限を持つ）
* [AWS CLI](https://aws.amazon.com/jp/cli/) (設定済みであること)
* [Terraform](https://www.terraform.io/downloads.html) (v1.x 以降)
* [Git](https://git-scm.com/downloads)
* [Python 3](https://www.python.org/downloads/) (フロントエンドのローカルテスト用)

### 1. リポジトリのクローン
まず、このリポジトリをローカル環境にクローンします。
```bash
git clone [https://github.com/teruterubz/terraform-portfolio-uploader.git](https://github.com/teruterubz/terraform-portfolio-uploader.git)
cd terraform-portfolio-uploader
## 工夫した点・苦労した点 (Highlights & Challenges)

このプロジェクトは、geminiをAI学習コーチとして設定し対話しながら日々の学習目標を明確にすることで、技術的な課題を一つずつ解決していくというスタイルで進めました。当初は、これほど多岐にわたるサービスを連携させたアプリケーションを自分一人で構築できるとは思いませんでしたが、以下の挑戦を通じて実現することができました。

### 工夫した点 (Highlights)

- **セキュアで効率的なファイルアップロード:**
  - ユーザーにAWS認証情報を渡すことなく安全にファイルをアップロードさせるため、バックエンドで動的に **S3署名付きURL** を発行するアーキテクチャを採用しました。これにより、クライアントのブラウザからS3へ直接ファイルを転送できるため、バックエンドサーバーの負荷を大幅に軽減しています。

- **イベント駆動による非同期処理:**
  - S3へのファイルアップロードが完了したことをトリガーに、**S3イベント通知**でLambda関数を起動させています。これにより、ファイルのメタデータ保存処理を非同期で行えるため、ユーザーのアップロード体験の応答性を損なわない構成を実現しました。

- **最小権限の原則に基づいたIAM設計:**
  - Lambda関数ごとに個別のIAMロールとIAMポリシーをTerraformで定義・管理しています。「署名付きURL生成」「メタデータ保存」「ファイル一覧取得」といった各機能が必要とする最低限の権限（S3へのPutObject、DynamoDBへのPutItemやScanなど）のみを付与することで、セキュリティのベストプラクティスである**最小権限の原則**を実践しました。

### 苦労した点と学び (Challenges & Learnings)

- **Terraformコードの保守性向上:**
  - 開発が進むにつれて `main.tf` が肥大化し、可読性・保守性が低下するという課題に直面しました。これを解決するため、リソースを役割ごと（`s3.tf`, `iam.tf`, `lambda.tf`など）にファイル分割する**リファクタリング**を実践しました。これにより、Terraformのコードをクリーンに保つ重要性と、その具体的な手法を学びました。

- **S3の現代的なセキュリティ設定への対応:**
  - 当初、オブジェクトACLで公開しようとした際に `AccessControlListNotSupported` エラーに直面しました。原因を調査する中で、現在のAWSのセキュリティ推奨設定（ACLの無効化）を学び、**バケットポリシー**を使ってアクセス制御を行うモダンな方法に切り替えることで解決しました。公式ドキュメントを読み解き、エラーからベストプラクティスを学ぶ良い経験となりました。

- **AIを思考のパートナーとした開発:**
  - このプロジェクト全体を通して、AIは単にコードを生成するツールではなく、**「なぜその技術を選ぶのか？」**という問いを深めるための思考の壁打ち相手でした。不明点を即座に質問・解消し、得られた知識をすぐに実践・デプロイするという高速な学習サイクルを回せたことが、このポートフォリオを短期間で完成させられた大きな要因です。AIを使いこなすための知識を蓄えながら、今後も成長していきたいです。
AIと相談しながらロードマップを作成し、工夫した点は正直こちらに取り組む前の自分ではこんなものを作れるとは思いませんでした。それをAIを使うことで、またそれによって日々何をやるかを明確化することでここまで取り組むことができました。
苦労した点は実際学習しながらの実践だったので内容の理解に苦労しました。その点何度もきけるAIでなければできなかった勉強法だとつくづく実感しています。AIとともに何かを作成するというのは何事も手軽に作ることができるようになったということですがそれを理解できていなければ、なぜそれを選んだのかがわかっていなければ意味がないと思います。それを今回実感しました。AIはあくまでツールでそれを使いこなすための知識も貯えながら成長していきたいと思いました。非常に学びのあるポートフォリオでした。
=======
## 工夫した点・苦労した点 (Highlights / Challenges)
>>>>>>> 8f65fd7c0a50cb1b5e14746702d2ee534949525a
